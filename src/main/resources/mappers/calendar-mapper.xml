<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="calMapper">
<resultMap type="calendarDto" id="calResultMap">
	<id column="CAL_NO" property="calNO" />
	<result column="CAL_SORT" property="calSort" />
	<result column="CAL_TITLE" property="calTitle" />
	<result column="CAL_CONTENT" property="calContent" />
	<result column="START_DATE" property="startDate" />
	<result column="END_DATE" property="endDate" />
	<result column="CAL_PLACE" property="place" />
	<result column="CAL_COLOR" property="color" />
	<result column="STATUS" property="status" />
	<result column="GROUP_CODE" property="groupCode" />
</resultMap>
<!-- 개인 및 부서 일정 조회 -->
<select id="selectPCalendar" resultMap="calResultMap">
select
    CAL_NO
    , CAL_SORT
    , CAL_TITLE
    , CAL_CONTENT
    , START_DATE
    , END_DATE
    , CAL_PLACE
    , CAL_COLOR
from 
	calender
where 
	cal_sort in ('P', 'D')
and 
	status = 'Y'
<![CDATA[
and 
	Months_between(START_DATE , sysdate) <= 6
and 
	Months_between(end_DATE		, sysdate) >= -6
]]>
</select>
<!-- 갤린더 일정 등록 쿼리 -->
<insert id="insertCal">
	insert 
	into calender(
			CAL_NO
			,CAL_TITLE
			,CAL_CONTENT
			,START_DATE
			,END_DATE
			,CAL_COLOR
			,REGIST_EMP
			,MODIFY_EMP
			,GROUP_CODE
	) values ( 
			SEQ_CALNO.nextval
			,#{calTitle}
			,#{calContent}
			,to_date(#{startDate} , 'YYYY-MM-DD HH24:MI:SS')
			,to_date(#{endDate}		, 'YYYY-MM-DD HH24:MI:SS')
			,#{color}
			,1<!-- REGIST_EMP -->
			,1<!-- MODIFY_EMP -->
			,1<!-- GROUP_CODE -->
		)
</insert>
<!-- 일정 별 동행자 추가 쿼리 -->
<insert id="inserCoworker">
	insert
	into co_worker(
		WORKER_NO
		, CAL_NO
		, USER_NO
	)values(
		SEQ_COWNO.NEXTVAL
		, SEQ_CALNO.CURRVAL
		, #{woker}
	)
</insert>
<!-- 일정 update문 쿼리 -->
<update id="calUpdate">
	update
		calender
	set 
		CAL_TITLE = #{calTitle}
		, CAL_CONTENT = #{calContent}
		, START_DATE 	= #{startDate}
		, END_DATE 		= #{endDate}
		, CAL_COLOR 	= #{color}
		, GROUP_CODE 	= #{groupCode}
		, MODIFY_EMP 	= SYSDATE
	where
		CAL_NO = #{calNO}
</update>


</mapper>
